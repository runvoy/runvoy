# AI Coding Assistant Rules for mycli
# Used by: Cursor, Claude Code, and other AI assistants that respect .cursorrules

## Documentation Standards

### Primary Documentation Files
- **README.md** - User-facing documentation (installation, usage, examples)
- **ARCHITECTURE.md** - Technical documentation (system design, implementation details)

### Documentation Update Policy

**CRITICAL: When making ANY code changes, you MUST update ARCHITECTURE.md if:**
- Adding/removing commands or features
- Changing API contracts or data structures
- Modifying configuration options
- Updating security model or IAM permissions
- Changing execution flow or architecture
- Adding/removing dependencies
- Updating cost implications
- Fixing bugs that affect documented behavior

**Before implementing changes:**
1. Read ARCHITECTURE.md to understand current system design
2. Reference specific sections relevant to your changes
3. Use code references (file:line) when discussing implementation

**After implementing changes:**
1. Update ARCHITECTURE.md with new behavior
2. Update code references if line numbers changed significantly
3. Update README.md if user-facing behavior changed
4. Keep both docs consistent and in sync

### Code References Format
When referencing code in ARCHITECTURE.md, use this format:
- `(cmd/exec.go:65)` for specific functions
- `(lambda/orchestrator/main.go:372)` for implementation details

### Documentation Sections to Check

When changing **CLI commands**: Update
- "CLI Commands Reference" section in ARCHITECTURE.md
- "Commands" section in README.md
- "API Contract" if API changes

When changing **Lambda orchestrator**: Update
- "Key Components > Lambda Orchestrator" section
- "Execution Flow" section
- "Shell Command Construction" section
- "API Contract" section

When changing **CloudFormation template**: Update
- "Key Components > CloudFormation Infrastructure" section
- "IAM Roles" in Security Model section
- "AWS Resource Summary" appendix

When changing **configuration**: Update
- "Configuration System" section in ARCHITECTURE.md
- "Configuration" section in README.md

When adding **new features**: Update
- All relevant sections in ARCHITECTURE.md
- "Features" in README.md
- "Examples" in README.md if user-visible
- "Future Enhancements" (remove if now implemented)

When fixing **bugs**: Update
- "Troubleshooting" section if common issue
- Remove from "Limitations" if limitation removed

## Code Quality Standards

### File Organization
- CLI commands in `cmd/` directory
- Shared types in `pkg/api/`
- Internal packages in `internal/`
- Lambda code in `lambda/orchestrator/`

### Error Handling
- Always return descriptive errors
- Use `fmt.Errorf` with context
- Log errors in Lambda with details

### Security
- Never log API keys or credentials
- Use shellEscape() for all user input in shell scripts
- Validate all API inputs

### Testing Approach
- Prefer integration tests over unit tests for now
- Test error scenarios (invalid inputs, auth failures, etc.)
- Document test commands in ARCHITECTURE.md

## Git Workflow

### Commit Messages
Use conventional commits format:
- `feat: add new feature`
- `fix: resolve bug`
- `docs: update documentation`
- `refactor: restructure code`
- `chore: maintenance tasks`

### Before Committing
1. Verify ARCHITECTURE.md is updated
2. Verify README.md is updated if needed
3. Test changes locally
4. Check for TODO comments that should be addressed

## Common Patterns

### Adding a New CLI Command
1. Create command file in `cmd/`
2. Register in `cmd/root.go`
3. Add API action if needed in `lambda/orchestrator/main.go`
4. Update `pkg/api/types.go` if new request/response types
5. Update ARCHITECTURE.md CLI Commands Reference
6. Update README.md Commands section
7. Add usage examples to README.md

### Adding a New Flag
1. Add flag in command file
2. Update API request in `internal/api/client.go`
3. Handle in Lambda orchestrator
4. Update ARCHITECTURE.md for that command
5. Update README.md examples
6. Update `.mycli.yaml` example if project-level config

### Modifying IAM Permissions
1. Update `deploy/cloudformation.yaml`
2. Update ARCHITECTURE.md IAM Roles section
3. Document why permission is needed
4. Add to Troubleshooting if was fixing an issue

## Architecture Principles

**Maintain these design decisions:**
- ✅ Use standard Docker images (no custom containers)
- ✅ Dynamic shell script construction
- ✅ Git as source of truth (no S3 code storage)
- ✅ Direct ECS/CloudWatch API usage (no DynamoDB for MVP)
- ✅ Simplicity over custom solutions

**When suggesting changes, respect:**
- Current bash script approach (unless serious limitations found)
- No custom Docker image requirement
- Cost optimization (FARGATE_SPOT, public subnets, no NAT)
- Security model (bcrypt, encrypted credentials)
